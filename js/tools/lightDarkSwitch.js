import{getStyleStatus,styleStatus,updateStyleStatus}from"../state/styleStatus.js";let mermaidSelector=".mermaid",didInitAuto=!1,ensureOriginalData=()=>{document.querySelectorAll(mermaidSelector).forEach(e=>{e.getAttribute("data-original-code")||e.setAttribute("data-original-code",e.innerHTML)})},resetProcessed=()=>{document.querySelectorAll(mermaidSelector).forEach(e=>{var t=e.getAttribute("data-original-code");null!==t&&(e.removeAttribute("data-processed"),e.innerHTML=t)})},ModeToggle={modeToggleButton_dom:null,iconDom:null,mermaidLightTheme:null,mermaidDarkTheme:null,mermaidInit(e){window.mermaid&&(ensureOriginalData(),resetProcessed(),mermaid.initialize({theme:e}),mermaid.init({theme:e},document.querySelectorAll(mermaidSelector)))},enableLightMode(){document.body.classList.remove("dark-mode"),document.documentElement.classList.remove("dark"),document.body.classList.add("light-mode"),document.documentElement.classList.add("light"),this.iconDom&&(this.iconDom.className="fa-regular fa-moon"),updateStyleStatus({isDark:!1}),this.mermaidInit(this.mermaidLightTheme),this.setGiscusTheme(),this.setUtterancesTheme()},enableDarkMode(){document.body.classList.remove("light-mode"),document.documentElement.classList.remove("light"),document.body.classList.add("dark-mode"),document.documentElement.classList.add("dark"),this.iconDom&&(this.iconDom.className="fa-regular fa-brightness"),updateStyleStatus({isDark:!0}),this.mermaidInit(this.mermaidDarkTheme),this.setGiscusTheme(),this.setUtterancesTheme()},async setGiscusTheme(t){if(document.querySelector("#giscus-container")){let e=document.querySelector("iframe.giscus-frame");for(;!e;)await new Promise(e=>setTimeout(e,1e3)),e=document.querySelector("iframe.giscus-frame");for(;e.classList.contains("giscus-frame--loading");)await new Promise(e=>setTimeout(e,1e3));t??=styleStatus.isDark?"dark":"light",e.contentWindow.postMessage({giscus:{setConfig:{theme:t}}},"https://giscus.app")}},async setUtterancesTheme(e){var i=document.querySelector("#utterances-container");if(i){var a=i.dataset.utterancesThemeLight||"github-light",i=i.dataset.utterancesThemeDark||"github-dark";e??=styleStatus.isDark?i:a;let t=document.querySelector("iframe.utterances-frame");for(let e=0;e<10&&!t;e+=1)await new Promise(e=>setTimeout(e,300)),t=document.querySelector("iframe.utterances-frame");t&&t.contentWindow&&t.contentWindow.postMessage({type:"set-theme",theme:e},"https://utteranc.es")}},isDarkPrefersColorScheme(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)")},initModeStatus(){var e=getStyleStatus();e?e.isDark?this.enableDarkMode():this.enableLightMode():this.isDarkPrefersColorScheme().matches?this.enableDarkMode():this.enableLightMode()},initModeToggleButton(e){var t;this.modeToggleButton_dom&&(t=()=>{document.body.classList.contains("dark-mode")?this.enableLightMode():this.enableDarkMode()},e?this.modeToggleButton_dom.addEventListener("click",t,{signal:e}):this.modeToggleButton_dom.addEventListener("click",t))},initModeAutoTrigger(e){var t,i=this.isDarkPrefersColorScheme();i&&!didInitAuto&&(didInitAuto=!0,t=e=>{e.matches?this.enableDarkMode():this.enableLightMode()},e?i.addEventListener("change",t,{signal:e}):i.addEventListener("change",t))},init({signal:e,appSignal:t}={}){this.modeToggleButton_dom=document.querySelector(".tool-dark-light-toggle"),this.iconDom=document.querySelector(".tool-dark-light-toggle i");var i=theme.plugins?.mermaid?.theme||theme.mermaid?.style||{};this.mermaidLightTheme=i.light||"default",this.mermaidDarkTheme=i.dark||"dark",this.initModeStatus(),this.initModeToggleButton(e),this.initModeAutoTrigger(t),ensureOriginalData()}};export default function initModeToggle(e={}){ModeToggle.init(e)}export{ModeToggle};