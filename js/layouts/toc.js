import{initTocToggle}from"../tools/tocToggle.js";import{getStyleStatus}from"../state/styleStatus.js";let tocState=null,didInitScroll=!1,registerScrollHandler=e=>{!didInitScroll&&e&&(didInitScroll=!0,window.addEventListener("scroll",()=>{tocState?.updateActiveTOCLink()},{signal:e}))};function initTOC({signal:e}={}){e&&registerScrollHandler(e);let n=document.querySelector(".toc-content-container");if(!n)return tocState=null;e=n.querySelectorAll(".post-toc li");let i=initTocToggle();if(0===e.length)return i.hideToggle(),n.remove(),document.querySelectorAll(".toc-marker").forEach(e=>{e.remove()}),tocState=null;let o={navItems:e,navLinks:n.querySelectorAll(".post-toc li a.nav-link"),updateActiveTOCLink(){if(Array.isArray(o.sections)){let e=o.sections.findIndex(e=>e&&0<e.getBoundingClientRect().top-100);-1===e?e=o.sections.length-1:0<e&&e--,this.activateTOCLink(e)}},registerTOCScroll(){o.sections=[...o.navLinks].map(e=>document.getElementById(decodeURI(e.getAttribute("href")).replace("#","")))},activateTOCLink(e){var t,i,e=o.navLinks[e];e&&!e.classList.contains("active-current")&&(n.querySelectorAll(".active").forEach(e=>{e.classList.remove("active","active-current")}),e.classList.add("active","active-current"),i=n.getBoundingClientRect().top,t=n.offsetHeight>window.innerHeight?(n.offsetHeight-window.innerHeight)/2:0,i=e.getBoundingClientRect().top-i-Math.max(document.documentElement.clientHeight,window.innerHeight||0)/2+e.offsetHeight/2-t,e=n.scrollTop+i,n.scrollTo({top:e,behavior:"smooth"}))},showTOCAside(){var e=()=>{var e=getStyleStatus(),t="isOpenPageAside";e&&e.hasOwnProperty(t)?i.pageAsideHandleOfTOC(e[t]):i.pageAsideHandleOfTOC(!0)},t="init_open";!theme.articles.toc.hasOwnProperty(t)||theme.articles.toc[t]?e():i.pageAsideHandleOfTOC(!1)}};return o.showTOCAside(),o.registerTOCScroll(),o.updateActiveTOCLink(),tocState=o}export{initTOC};