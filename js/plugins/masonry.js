let initializedContainers=new WeakSet,getRoot=()=>{var e;return"undefined"==typeof window?"/":(e=window.config?.root||"/").endsWith("/")?e:e+"/"},getBlankPlaceholderSrc=()=>"data:image/gif;base64,R0lGODlhAQABAAAAACw=",getBaseWidth=()=>768<=window.innerWidth?255:150,throttleFrame=e=>{let t=null;return()=>{null===t&&(t=window.requestAnimationFrame(()=>{t=null,e()}))}},ensureImageLoaded=e=>{var t;e&&e.hasAttribute("lazyload")&&((t=e.getAttribute("data-src"))&&(e.src=t),e.removeAttribute("lazyload"),delete e.dataset.redefineLazyloadObserved)};export default function initMasonry({signal:o}={}){let n=document.querySelector("#masonry-container");if(!n)return;if(initializedContainers.has(n))return;if(initializedContainers.add(n),"undefined"==typeof MiniMasonry)return void console.error("MiniMasonry is not available.");let t=document.querySelector("#masonry-loadmore"),a=document.querySelector("#masonry-sentinel"),i=n.dataset.masonryDataUrl||getRoot()+"masonry/data.json";var e=Number.parseInt(window.theme?.page_templates?.masonry?.batch_size,10),r=Number.parseInt(window.theme?.page_templates?.masonry?.initial_batch_size,10);if(Number.isFinite(e)||console.warn("[redefine] page_templates.masonry.batch_size is missing."),Number.isFinite(r)||console.warn("[redefine] page_templates.masonry.initial_batch_size is missing."),!i)return void console.warn("Masonry data url is missing.");let s=new MiniMasonry({baseWidth:getBaseWidth(),container:n,gutterX:10,gutterY:10,surroundingGutter:!1}),d=throttleFrame(()=>{s.layout()}),l=[],m=0,c=!1,u=Number.isFinite(r)?Math.max(1,r):24,g=Number.isFinite(e)?Math.max(1,e):12;r="undefined"!=typeof IntersectionObserver;let h=r?new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e=e.target,h.unobserve(e),ensureImageLoaded(e))})},{rootMargin:"200px 0px",threshold:.1}):null,y=e=>{var t=document.createElement("div"),n=(t.className="masonry-item",document.createElement("div")),a=(n.className="image-container",Number.parseInt(e.width,10)),i=Number.parseInt(e.height,10);let r=Number.isFinite(a)&&Number.isFinite(i)&&0<a&&0<i,s=(r&&(n.classList.add("has-ratio"),n.style.setProperty("--masonry-aspect-ratio",a+" / "+i)),document.createElement("img"));s.className="masonry-img is-loading",s.alt=e.title||"",r&&(s.width=a,s.height=i),s.decoding="async",s.loading="lazy",s.setAttribute("lazyload",""),s.setAttribute("data-src",e.image),s.src=getBlankPlaceholderSrc(),s.dataset.exif=e?.exif?"true":"false";var a=()=>{s.hasAttribute("lazyload")||(s.classList.remove("is-loading"),r)||d()};return o?(s.addEventListener("load",a,{signal:o}),s.addEventListener("error",a,{signal:o})):(s.addEventListener("load",a),s.addEventListener("error",a)),h?h.observe(s):ensureImageLoaded(s),n.appendChild(s),e.title&&((i=document.createElement("div")).className="image-title",i.textContent=e.title,n.appendChild(i)),e.description&&((a=document.createElement("div")).className="image-description",a.textContent=e.description,n.appendChild(a)),t.appendChild(n),t},b=e=>{t&&t.classList.toggle("is-hidden",!e)},p=e=>{if(o?.aborted||!n.isConnected)return!1;e=l.slice(m,m+e);if(0===e.length)return!1;let t=document.createDocumentFragment();return e.forEach(e=>{t.appendChild(y(e))}),n.appendChild(t),m+=e.length,d(),m<l.length},v=a&&r?new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&!c&&!o?.aborted&&n.isConnected&&(c=!0,b(!0),e=p(g),c=!1,b(!1),!e)&&a&&v&&(v.disconnect(),a.remove())},{rootMargin:"200px 0px",threshold:.1}):null;e=()=>{s.conf.baseWidth=getBaseWidth(),d()};o?(window.addEventListener("resize",e,{signal:o}),o.addEventListener("abort",()=>{h?.disconnect(),v?.disconnect()})):window.addEventListener("resize",e);(async()=>{try{var e=await fetch(i,o?{signal:o}:void 0);if(!e.ok)throw new Error("Request failed with status "+e.status);l=await e.json()}catch(e){return!(o?.aborted||"AbortError"===e?.name||(console.error("Failed to load masonry data:",e),a&&a.remove()))}if(Array.isArray(l)&&0!==l.length){if(!o?.aborted&&n.isConnected)if(p(u),n.classList.remove("min-h-screen!"),m<l.length)if(a&&v)v.observe(a);else for(;m<l.length;)p(g);else a&&a.remove()}else a&&a.remove()})()}