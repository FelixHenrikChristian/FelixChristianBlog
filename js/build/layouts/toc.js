import{initTocToggle as e}from"../tools/tocToggle.js";import{getStyleStatus as t}from"../state/styleStatus.js";let n=null,i=!1;function initTOC({signal:o}={}){o&&(o=o,!i)&&o&&(i=!0,window.addEventListener("scroll",()=>{n?.updateActiveTOCLink()},{signal:o}));let r=document.querySelector(".toc-content-container");if(!r)return n=null;let l=r.querySelectorAll(".post-toc li"),s=e();if(0===l.length)return s.hideToggle(),r.remove(),document.querySelectorAll(".toc-marker").forEach(e=>{e.remove()}),n=null;let c={navItems:l,navLinks:r.querySelectorAll(".post-toc li a.nav-link"),updateActiveTOCLink(){if(Array.isArray(c.sections)){let e=c.sections.findIndex(e=>e&&0<e.getBoundingClientRect().top-100);-1===e?e=c.sections.length-1:0<e&&e--,this.activateTOCLink(e)}},registerTOCScroll(){c.sections=[...c.navLinks].map(e=>document.getElementById(decodeURI(e.getAttribute("href")).replace("#","")))},activateTOCLink(e){var t,i,e=c.navLinks[e];e&&!e.classList.contains("active-current")&&(r.querySelectorAll(".active").forEach(e=>{e.classList.remove("active","active-current")}),e.classList.add("active","active-current"),i=r.getBoundingClientRect().top,t=r.offsetHeight>window.innerHeight?(r.offsetHeight-window.innerHeight)/2:0,i=e.getBoundingClientRect().top-i-Math.max(document.documentElement.clientHeight,window.innerHeight||0)/2+e.offsetHeight/2-t,e=r.scrollTop+i,r.scrollTo({top:e,behavior:"smooth"}))},showTOCAside(){var e=()=>{var e=t(),i="isOpenPageAside";e&&e.hasOwnProperty(i)?s.pageAsideHandleOfTOC(e[i]):s.pageAsideHandleOfTOC(!0)},i="init_open";!theme.articles.toc.hasOwnProperty(i)||theme.articles.toc[i]?e():s.pageAsideHandleOfTOC(!1)}};return c.showTOCAside(),c.registerTOCScroll(),c.updateActiveTOCLink(),n=c}export{initTOC};