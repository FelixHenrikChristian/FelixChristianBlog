let e=new WeakSet,getBaseWidth=()=>768<=window.innerWidth?255:150,ensureImageLoaded=e=>{var t;e&&e.hasAttribute("lazyload")&&((t=e.getAttribute("data-src"))&&(e.src=t),e.removeAttribute("lazyload"),delete e.dataset.redefineLazyloadObserved)};export default function initMasonry({signal:f}={}){let v=document.querySelector("#masonry-container");if(v&&!e.has(v))if(e.add(v),"undefined"==typeof MiniMasonry)console.error("MiniMasonry is not available.");else{let g=document.querySelector("#masonry-loadmore"),h=document.querySelector("#masonry-sentinel"),y=v.dataset.masonryDataUrl||`${"undefined"==typeof window?"/":(t=window.config?.root||"/").endsWith("/")?t:t+"/"}masonry/data.json`,b=Number.parseInt(window.theme?.page_templates?.masonry?.batch_size,10),p=Number.parseInt(window.theme?.page_templates?.masonry?.initial_batch_size,10);var t;if(Number.isFinite(b)||console.warn("[redefine] page_templates.masonry.batch_size is missing."),Number.isFinite(p)||console.warn("[redefine] page_templates.masonry.initial_batch_size is missing."),y){let t=new MiniMasonry({baseWidth:getBaseWidth(),container:v,gutterX:10,gutterY:10,surroundingGutter:!1}),d=(()=>{let e=null;return()=>{null===e&&(e=window.requestAnimationFrame(()=>{e=null,t.layout()}))}})(),n=[],a=0,i=!1,r=Number.isFinite(p)?Math.max(1,p):24,s=Number.isFinite(b)?Math.max(1,b):12,e="undefined"!=typeof IntersectionObserver,l=e?new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(e=e.target,l.unobserve(e),ensureImageLoaded(e))})},{rootMargin:"200px 0px",threshold:.1}):null,o=e=>{g&&g.classList.toggle("is-hidden",!e)},m=e=>{if(f?.aborted||!v.isConnected)return!1;e=n.slice(a,a+e);if(0===e.length)return!1;let t=document.createDocumentFragment();return e.forEach(e=>{t.appendChild((t=>{var e=document.createElement("div"),n=(e.className="masonry-item",document.createElement("div"));n.className="image-container";let a=Number.parseInt(t.width,10),i=Number.parseInt(t.height,10),r=Number.isFinite(a)&&Number.isFinite(i)&&0<a&&0<i,s=(r&&(n.classList.add("has-ratio"),n.style.setProperty("--masonry-aspect-ratio",a+" / "+i)),document.createElement("img"));s.className="masonry-img is-loading",s.alt=t.title||"",r&&(s.width=a,s.height=i),s.decoding="async",s.loading="lazy",s.setAttribute("lazyload",""),s.setAttribute("data-src",t.image),s.src="data:image/gif;base64,R0lGODlhAQABAAAAACw=",s.dataset.exif=t?.exif?"true":"false";var o=()=>{s.hasAttribute("lazyload")||(s.classList.remove("is-loading"),r)||d()};if(f?(s.addEventListener("load",o,{signal:f}),s.addEventListener("error",o,{signal:f})):(s.addEventListener("load",o),s.addEventListener("error",o)),l?l.observe(s):ensureImageLoaded(s),n.appendChild(s),t.title){let e=document.createElement("div");e.className="image-title",e.textContent=t.title,n.appendChild(e)}if(t.description){let e=document.createElement("div");e.className="image-description",e.textContent=t.description,n.appendChild(e)}return e.appendChild(n),e})(e))}),v.appendChild(t),a+=e.length,d(),a<n.length},c=h&&e?new IntersectionObserver(e=>{e.some(e=>e.isIntersecting)&&!i&&!f?.aborted&&v.isConnected&&(i=!0,o(!0),e=m(s),i=!1,o(!1),!e)&&h&&c&&(c.disconnect(),h.remove())},{rootMargin:"200px 0px",threshold:.1}):null,u=()=>{t.conf.baseWidth=getBaseWidth(),d()};f?(window.addEventListener("resize",u,{signal:f}),f.addEventListener("abort",()=>{l?.disconnect(),c?.disconnect()})):window.addEventListener("resize",u),(async()=>{try{var e=await fetch(y,f?{signal:f}:void 0);if(!e.ok)throw new Error("Request failed with status "+e.status);n=await e.json()}catch(e){return!(f?.aborted||"AbortError"===e?.name||(console.error("Failed to load masonry data:",e),h&&h.remove()))}if(Array.isArray(n)&&0!==n.length){if(!f?.aborted&&v.isConnected)if(m(r),v.classList.remove("min-h-screen!"),a<n.length)if(h&&c)c.observe(h);else for(;a<n.length;)m(s);else h&&h.remove()}else h&&h.remove()})()}else console.warn("Masonry data url is missing.")}}