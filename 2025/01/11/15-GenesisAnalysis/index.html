<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Felix Christian"><script>!function(){const e="dark";function t(t){const o=t===e,c=document.documentElement;c.setAttribute("data-theme",t),c.classList.add(t),c.classList.remove(o?"light":e),c.style.colorScheme=t}const o=function(){try{const t=localStorage.getItem("REDEFINE-THEME-STATUS");if(t){const{isDark:o}=JSON.parse(t);return o?e:"light"}}catch(e){}return matchMedia("(prefers-color-scheme: dark)").matches?e:"light"}();t(o),matchMedia("(prefers-color-scheme: dark)").addEventListener("change",({matches:o})=>{localStorage.getItem("REDEFINE-THEME-STATUS")||t(o?e:"light")}),"loading"!==document.readyState?document.body.classList.add(o+"-mode"):document.addEventListener("DOMContentLoaded",()=>{document.body.classList.add(o+"-mode"),document.body.classList.remove((o===e?"light":e)+"-mode")})}()</script><style>:root[data-theme=dark]{--background-color:#202124;--background-color-transparent:rgba(32, 33, 36, 0.6);--second-background-color:#2d2e32;--third-background-color:#34353a;--third-background-color-transparent:rgba(32, 33, 36, 0.6);--primary-color:#0066CC;--first-text-color:#ffffff;--second-text-color:#eeeeee;--third-text-color:#bebec6;--fourth-text-color:#999999;--default-text-color:#bebec6;--invert-text-color:#373D3F;--border-color:rgba(255, 255, 255, 0.08);--selection-color:#0066CC;--shadow-color-1:rgba(255, 255, 255, 0.08);--shadow-color-2:rgba(255, 255, 255, 0.05)}:root[data-theme=light]{--background-color:#fff;--background-color-transparent:rgba(255, 255, 255, 0.6);--second-background-color:#f8f8f8;--third-background-color:#f2f2f2;--third-background-color-transparent:rgba(241, 241, 241, 0.6);--primary-color:#0066CC;--first-text-color:#16171a;--second-text-color:#2f3037;--third-text-color:#5e5e5e;--fourth-text-color:#eeeeee;--default-text-color:#373D3F;--invert-text-color:#bebec6;--border-color:rgba(0, 0, 0, 0.08);--selection-color:#0066CC;--shadow-color-1:rgba(0, 0, 0, 0.08);--shadow-color-2:rgba(0, 0, 0, 0.05)}body{background-color:var(--background-color);color:var(--default-text-color)}:root[data-theme=dark] body{background-color:var(--background-color);color:var(--default-text-color)}</style><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://evan.beee.top" crossorigin><link rel="canonical" href="https://felixchristian.top/2025/01/11/15-genesisanalysis/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="Hexo Theme Redefine, Redefine Your Hexo Journey."><meta property="og:type" content="article"><meta property="og:title" content="Genesis分析"><meta property="og:url" content="https://felixchristian.top/2025/01/11/15-GenesisAnalysis/index.html"><meta property="og:site_name" content="FelixChristian&#39;s Blog"><meta property="og:description" content="Hexo Theme Redefine, Redefine Your Hexo Journey."><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://felixchristian.top/images/redefine-og.webp"><meta property="article:published_time" content="2025-01-11T10:57:05.000Z"><meta property="article:modified_time" content="2025-02-06T12:13:37.614Z"><meta property="article:author" content="Felix Christian"><meta property="article:tag" content="mujoco"><meta property="article:tag" content="genesis"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://felixchristian.top/images/redefine-og.webp"><link rel="icon" type="image/png" href="/images/favicon.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/favicon.png"><title>Genesis分析 | FelixChristian&#39;s Blog</title><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fonts/Chillax/chillax.css"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/css/build/tailwind.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fonts/GeistMono/geist-mono.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fonts/Geist/geist.css"><script id="hexo-configurations">window.config={hostname:"felixchristian.top",root:"/",language:"zh-CN",path:"search.json"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0,delete_mask:!0,title_alignment:"left",headings_top_spacing:{h1:"3.2rem",h2:"2.4rem",h3:"1.9rem",h4:"1.6rem",h5:"1.4rem",h6:"1.3rem"}},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!0,list:[]},code_block:{copy:!0,style:"mac",highlight_theme:{light:"github",dark:"vs2015"},font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!1,expand:!0,init_open:!0},copyright:{enable:!0,default:"cc_by_nc_sa"},lazyload:!0,pangu_js:!1,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:null,default_mode:"light"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null},title:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!1},scroll_progress:{bar:!1,percentage:!0},website_counter:{url:"https://cn.vercount.one/js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,preloader:{enable:!1,custom_message:null},side_tools:{gear_rotation:!0,auto_expand:!1},open_graph:{enable:!0,image:"/images/redefine-og.webp",description:"Hexo Theme Redefine, Redefine Your Hexo Journey."},google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/backgroud_light.jpg",dark:"/images/backgroud_dark.jpg"},title:"Felix Christian的个人博客",subtitle:{text:["Loading..."],hitokoto:{enable:!0,show_author:!0,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#fff",dark:"#d1d1b6"},text_style:{title_size:"2.8rem",subtitle_size:"1.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!0,style:"center",links:{github:"https://github.com/FelixChristian011226",instagram:null,zhihu:null,twitter:null,email:"3200105627@zju.edu.cn",facebook:"https://www.facebook.com/profile.php?id=100021040783510&mibextid=ZbWKwL",youtube:"https://www.youtube.com/@felix-christian",discord:"https://discordapp.com/users/1166802766669287434"},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null,lrc:null}]},mermaid:{enable:!0,version:"11.4.1"}},version:"2.8.5",navbar:{auto_hide:!1,color:{left:"#f78736",right:"#367df7",transparency:35},width:{home:"1200px",pages:"1000px"},links:{Home:{path:"/",icon:"fa-regular fa-house"},Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{icon:"fa-solid fa-tags",path:"/tags/"},Categories:{icon:"fa-solid fa-folder",path:"/categories/"},"书签":{icon:"fa-solid fa-bookmark",path:"/bookmarks/"},About:{icon:"fa-regular fa-user",submenus:{Me:"/about",Github:"https://github.com/FelixChristian011226"}}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur",bookmarks_column:3},home:{sidebar:{enable:!0,position:"left",first_item:"info",announcement:null,show_on_mobile:!0,links:{Archives:{path:"/archives",icon:"fa-regular fa-archive"},Tags:{path:"/tags",icon:"fa-regular fa-tags"},Categories:{path:"/categories",icon:"fa-regular fa-folder"}}},article_date_format:"auto",excerpt_length:200,categories:{enable:!0,limit:3},tags:{enable:!0,limit:3}},footerStart:"2024/11/5 16:26:14"},window.lang_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},window.data={masonry:!1}</script><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fontawesome/brands.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fontawesome/solid.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fontawesome/regular.min.css"><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/fontawesome/sharp-solid.min.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div class="progress-bar-container"><span class="pjax-progress-bar"></span></div><main class="page-container" id="swup"><div class="main-content-container flex flex-col justify-between min-h-dvh"><div class="main-content-header"><header class="navbar-container px-6 md:px-12"><div class="navbar-content transition-navbar"><div class="left"><a class="logo-image h-8 w-8 sm:w-10 sm:h-10 mr-3" href="/"><img src="/images/favicon.png" class="w-full h-full rounded-xs"> </a><a class="logo-title" href="/">FelixChristian&#39;s Blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house fa-fw"></i> 首页</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive fa-fw"></i> 归档</a></li><li class="navbar-item"><a href="/tags/"><i class="fa-solid fa-tags fa-fw"></i> 标签</a></li><li class="navbar-item"><a href="/categories/"><i class="fa-solid fa-folder fa-fw"></i> 分类</a></li><li class="navbar-item"><a href="/bookmarks/"><i class="fa-solid fa-bookmark fa-fw"></i> 书签</a></li><li class="navbar-item"><a class="has-dropdown" href="#" onclick="&#34;return" false;&#34;><i class="fa-regular fa-user fa-fw"></i> 关于 <i class="fa-solid fa-chevron-down fa-fw"></i></a><ul class="sub-menu"><li><a href="/about">ME</a></li><li><a target="_blank" rel="noopener" href="https://github.com/FelixChristian011226">GITHUB</a></li></ul></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer h-dvh w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between"><ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start"><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/"><span>首页 </span><i class="fa-regular fa-house fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/archives"><span>归档 </span><i class="fa-regular fa-archive fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/tags/"><span>标签 </span><i class="fa-solid fa-tags fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/categories/"><span>分类 </span><i class="fa-solid fa-folder fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full"><a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" href="/bookmarks/"><span>书签 </span><i class="fa-solid fa-bookmark fa-sm fa-fw"></i></a></li><li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full"><div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full" navbar-data-toggle="submenu-About"><span>关于 </span><i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i></div><div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-About"><div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="text-third-text-color text-xl" href="/about">ME</a></div><div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl"><a class="text-third-text-color text-xl" target="_blank" rel="noopener" href="https://github.com/FelixChristian011226">GITHUB</a></div></div></li></ul><div class="statistics flex justify-around my-2.5"><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">20</div><div class="label text-third-text-color text-sm">标签</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">8</div><div class="label text-third-text-color text-sm">分类</div></a><a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives"><div class="number text-2xl sm:text-xl text-second-text-color font-semibold">26</div><div class="label text-third-text-color text-sm">文章</div></a></div></div><div class="window-mask"></div></header></div><div class="main-content-body transition-fade-up"><div class="main-content"><div class="post-page-container flex relative justify-between box-border w-full h-full"><div class="article-content-container"><div class="article-title relative w-full"><img src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/02/892b38f64382aaa071b177fb19b39e07.png" alt="Genesis分析" class="w-full h-60 sm:h-72 md:h-80 object-cover sm:rounded-t-large dark:brightness-75"><div class="w-full flex items-center absolute bottom-0 justify-start"><h1 class="article-title-cover text-center mx-6 my-6 text-second-text-color bg-background-color-transparent px-4 py-3 text-3xl sm:text-4xl md:text-5xl font-semibold backdrop-blur-lg rounded-xl border border-border-color">Genesis分析</h1></div></div><div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/avatar.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">Felix Christian</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2025-01-11 18:57:05</span> <span class="mobile">2025-01-11 18:57:05</span> <span class="hover-info">创建</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2025-02-06 20:13:37</span> <span class="mobile">2025-02-06 20:13:37</span> <span class="hover-info">更新</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/%E6%9C%BA%E5%99%A8%E4%BB%BF%E7%9C%9F/">机器仿真</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/mujoco/">mujoco</a>&nbsp;</li><li>| <a href="/tags/genesis/">genesis</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>3.9k 字</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>14 分钟</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8"><h2 id="taichi">Taichi</h2><h3 id="ti.func-ti.kernel"><span class="citation" data-cites="ti.func">@ti.func</span> &amp; <span class="citation" data-cites="ti.kernel">@ti.kernel</span></h3><blockquote><p>When writing compute-intensive tasks, users can leverage Taichi's high performance computation by following a set of extra rules, and making use of the two decorators <code>@ti.func</code> and <code>@ti.kernel</code>. These decorators instruct Taichi to take over the computation tasks and compile the decorated functions to machine code using its just-in-time (JIT) compiler. As a result, calls to these functions are executed on multi-core CPUs or GPUs and can achieve acceleration by 50x~100x compared to native Python code.</p><p>在编写计算密集型任务时，用户可以通过遵循一组额外规则并使用两个装饰器 <code>@ti.func</code> 和 <code>@ti.kernel</code> 来利用 Taichi 的高性能计算。这些装饰器指示 Taichi 接管计算任务，并使用其即时 (JIT) 编译器将装饰函数编译为机器代码。因此，对这些函数的调用在多核 CPU 或 GPU 上执行，与原生 Python 代码相比，可以实现 50 倍~100 倍的加速。</p></blockquote><p><strong><span class="citation" data-cites="ti.kernel">@ti.kernel</span>:</strong> 用 <code>@ti.kernel</code> 修饰的函数称为 Taichi 内核或简称为内核。这些函数是Taichi运行时接管任务的入口点，它们必须由Python代码直接调用。您可以使用原生 Python 来准备任务，例如从磁盘读取数据和预处理，然后调用内核将计算密集型任务卸载到 Taichi。</p><p><strong><span class="citation" data-cites="ti.func">@ti.func</span></strong>: 用 <code>@ti.func</code> 修饰的函数称为 Taichi 函数。这些函数是内核的构建块，只能由另一个 Taichi 函数或内核调用。与普通的 Python 函数一样，您可以将任务划分为多个 Taichi 函数，以增强可读性并在不同的内核中重用它们。</p><p><strong>Notes</strong>:</p><ul><li>Taichi 要求内核的参数和返回值进行类型提示，除非它既没有参数也没有返回语句。</li><li>内核或 Taichi 函数内的代码是 Taichi 范围的一部分。 Taichi 的运行时在多核 CPU 或 GPU 设备上并行编译和执行该代码，以实现高性能计算。 Taichi 作用域相当于 CUDA 的设备端。</li><li>Taichi 范围之外的代码属于 Python 范围。这段代码是用原生Python编写的，并由Python的虚拟机执行，而不是由Taichi的运行时执行。 Python 作用域相当于 CUDA 的主机端。</li></ul><h4 id="kernel-notes">Kernel Notes</h4><ul><li>一个内核可以接受多个参数。但是，请务必注意，您不能将任意 Python 对象传递给内核。这是因为 Python 对象可以是动态的，并且可能包含 Taichi 编译器无法识别的数据。</li><li>标量、 <code>ti.types.matrix()</code> 、 <code>ti.types.vector()</code> 和 <code>ti.types.struct()</code> 按值传递，这意味着内核收到参数的副本。但是， <code>ti.types.ndarray()</code> 和 <code>ti.template()</code> 是通过引用传递的，这意味着对内核内部参数所做的任何更改也会影响原始值。</li><li>您可以使用 <code>ti.types.ndarray()</code> 作为类型提示，将 <code>ndarray</code> 从 NumPy 或 <code>tensor</code> 从 PyTorch 传递到内核。 Taichi 可以识别这些数据结构的形状和数据类型，这使您可以在内核中访问它们的属性。</li><li>最多允许有一个返回值，该返回值可以是标量、 <code>ti.types.matrix()</code> 或 <code>ti.types.vector()</code> 。此外，在基于 LLVM 的后端（CPU 和 CUDA 后端）中，返回值也可以是 <code>ti.types.struct()</code> 。</li><li>全局变量视为编译时常量。这意味着它在编译时获取全局变量的当前值，并且之后不会跟踪它们的更改。</li></ul><h4 id="func-notes">Func Notes:</h4><ul><li>所有的 Taichi 函数都被强制内联 -&gt; 不允许运行时递归。</li><li>Taichi 函数可以接受多个参数，其中可能包括标量、 <code>ti.types.matrix()</code> 、 <code>ti.types.vector()</code> 、 <code>ti.types.struct()</code> 、 <code>ti.types.ndarray()</code> 、 <code>ti.field()</code> 类型。</li><li>可以有多个返回值。</li></ul><h4 id="comparison">Comparison</h4><table><colgroup><col style="width:18%"><col style="width:40%"><col style="width:40%"></colgroup><thead><tr><th></th><th>kernel</th><th>func</th></tr></thead><tbody><tr><td>调用范围</td><td>Python 作用域</td><td>Taichi 作用域</td></tr><tr><td>参数的类型提示</td><td>必需</td><td>推荐</td></tr><tr><td>返回值的类型提示</td><td>必需</td><td>推荐</td></tr><tr><td>返回类型</td><td>标量<br><code>ti.types.matrix()</code><br><code>ti.types.vector()</code><br><code>ti.types.struct()</code>(Only on LLVM-based backends)</td><td>标量<br><code>ti.types.matrix()</code><br><code>ti.types.vector()</code><br><code>ti.types.struct()</code><br>...</td></tr><tr><td>参数中元素数量上限</td><td>32（适用于 OpenGL）64（适用于其他后端）</td><td>无限制</td></tr><tr><td>return 语句中返回值数量上限</td><td>1</td><td>无限</td></tr></tbody></table><h3 id="ti.dataclass"><span class="citation" data-cites="ti.dataclass">@ti.dataclass</span></h3><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ti.dataclassclass </span></span><br><span class="line">	Sphere:</span><br><span class="line">    	center: vec3    </span><br><span class="line">    	radius: <span class="built_in">float</span></span><br></pre></td></tr></table></figure></div><h3 id="field">Field</h3><p>Taichi field 是<strong>全局</strong>数据容器，从 Python 作用域或 Taichi 作用域均能访问。</p><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">f_2d = ti.field(<span class="built_in">int</span>, shape=(<span class="number">3</span>, <span class="number">6</span>))  <span class="comment"># A 2D field in the shape (3, 6)</span></span><br></pre></td></tr></table></figure></div><ul><li><p><strong>Scalar field</strong>: 存储的是标量，是最基本的 field。</p><ul><li><p>一个0D 的标量 field 是单个标量。</p></li><li><p>一个一维标量 field 是由标量组成的一个一维数组。</p></li><li><p>一个二维标量 field 是由标量组成的一个二维数组，以此类推。</p></li></ul></li></ul><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Declares a 3x3 vector field comprising 2D vectors</span></span><br><span class="line">f = ti.Vector.field(n=<span class="number">2</span>, dtype=<span class="built_in">float</span>, shape=(<span class="number">3</span>, <span class="number">3</span>))</span><br></pre></td></tr></table></figure></div><ul><li><strong>Vector field</strong>: 每个元素都是<code>N</code>维向量的向量场。</li></ul><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Declares a 300x400x500 matrix field, each of its elements being a 3x2 matrix</span></span><br><span class="line">tensor_field = ti.Matrix.field(n=<span class="number">3</span>, m=<span class="number">2</span>, dtype=ti.f32, shape=(<span class="number">300</span>, <span class="number">400</span>, <span class="number">500</span>))</span><br></pre></td></tr></table></figure></div><ul><li><p><strong>Matrix field</strong>: 每个元素都是矩阵。</p><ul><li><p>矩阵运算在编译时展开。</p></li><li><p>在较大的矩阵（例如<code>32x128</code> ）上运行可能会导致编译时间更长且性能较差。</p></li></ul></li></ul><div class="code-container" data-rel="Python"><figure class="iseeu highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Declares a 1D struct field using the ti.Struct.field() method</span></span><br><span class="line">n = <span class="number">10</span></span><br><span class="line">particle_field = ti.Struct.field(&#123;    </span><br><span class="line">    <span class="string">&quot;pos&quot;</span>: ti.math.vec3,    </span><br><span class="line">    <span class="string">&quot;vel&quot;</span>: ti.math.vec3,    </span><br><span class="line">    <span class="string">&quot;acc&quot;</span>: ti.math.vec3,    </span><br><span class="line">    <span class="string">&quot;mass&quot;</span>: <span class="built_in">float</span>,  </span><br><span class="line">&#125;, shape=(n,))</span><br></pre></td></tr></table></figure></div><ul><li><strong>Struct field</strong>: 存储用户自定义的结构体。</li></ul><p>Taichi 编译器能够自动推断底层的数据布局并应用合适的数据读取顺序。 这是 Taichi 编程语言相较其他大多数通用编程语言的一大优势。</p><h3 id="ndarray">Ndarray</h3><ul><li><code>ndarray</code> 总是分配一个连续的内存块，以允许与外部库进行直接的数据交换。</li><li>与 <code>field</code> 一样，ndarray 只能在 Python 作用域中构造，而不能在 Taichi 作用域中构造。也就是说，不能在 Taichi 内核或函数内部构造 ndarray。</li><li>当标量类型的 NumPy ndarray 或 PyTorch 张量作为参数传递给 Taichi 内核时，它可以被解释为标量类型数组、向量类型数组或矩阵类型数组。这是由类型提示<code>ti.types.ndarray()</code>中的<code>dtype</code>和<code>ndim</code>选项控制的。</li></ul><h2 id="genesis">Genesis</h2><h3 id="rigid-solver">Rigid Solver</h3><h4 id="init">Init</h4><p><strong>作用</strong>：初始化求解器对象，设置其初始状态和配置信息。</p><p><strong>功能</strong>：</p><ol type="1"><li>调用基类 <code>Solver</code> 的初始化。</li><li>根据 <code>options</code> 配置求解器行为：<ul><li>是否启用碰撞检测、关节限制、自碰撞。</li><li>最大碰撞对数量。</li><li>动力学积分器类型。</li><li>是否启用休眠优化（hibernation）。</li></ul></li><li>初始化内部变量，如当前步数 <code>_cur_step</code>，以及存储实体的列表 <code>_entities</code>。</li></ol><h4 id="add-entity">Add Entity</h4><p><strong>作用</strong>：添加一个物理实体（如刚体、机器人、无人机等）到求解器中。</p><p><strong>参数</strong>：</p><ul><li><code>idx</code>：实体的全局索引，用于唯一标识。</li><li><code>material</code>：该实体的材质类型（例如刚体或角色）。</li><li><code>morph</code>：实体的形态类型（例如无人机形态）。</li><li><code>surface</code>：几何表面信息（用于碰撞检测或渲染）。</li><li><code>visualize_contact</code>：是否需要可视化接触点。</li></ul><p><strong>功能</strong>：</p><ol type="1"><li>根据 <code>material</code> 和 <code>morph</code> 类型选择实体的类别：<ul><li><code>AvatarEntity</code>：角色实体。</li><li><code>DroneEntity</code>：无人机实体。</li><li><code>RigidEntity</code>：普通刚体。</li></ul></li><li>检查是否支持显示接触点（AvatarEntity不支持）。</li><li>初始化实体对象，并将其添加到 <code>_entities</code> 列表中。</li></ol><p><strong>返回值</strong>：新创建的实体对象。</p><h4 id="build">Build</h4><p><strong>作用</strong>：构建求解器的内部状态和数据结构，为模拟做好准备。</p><p><strong>功能</strong>：</p><ol type="1"><li>初始化全局变量（如环境数量 <code>n_envs</code> 和并行级别 <code>_para_level</code>）。</li><li>调用每个实体的 <code>build</code> 方法，设置其相关参数。</li><li>初始化关键的数据结构：<ul><li>自由度数量、关节数量、几何体数量等统计数据。</li><li>动力学矩阵（质量矩阵等）和字段（如自由度状态、几何体状态）。</li></ul></li><li>运行初始的正向运动学（Forward Kinematics）更新几何体状态。</li><li>初始化碰撞检测器、约束求解器等模块。</li></ol><h2 id="comparison-with-genesis-and-mujoco">Comparison with Genesis and Mujoco</h2><h3 id="pipeline">0. Pipeline</h3><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/66641f62f2a0709cfd82988323d9621a.png" alt="image-20250114182316234" style="zoom:80%"></p><h3 id="mass-matrix">1. Mass Matrix</h3><table><colgroup><col style="width:8%"><col style="width:45%"><col style="width:45%"></colgroup><thead><tr><th></th><th>Genesis</th><th>Mujoco</th></tr></thead><tbody><tr><td>CRB</td><td><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/3a9b38c8b00a256ef7a151b7103f92a5.png" alt="image-20250111173536192" style="zoom:50%"></td><td><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/1ff531db30eeb7b9593ea78de78d8fd5.png" alt="image-20250111173559608" style="zoom:50%"></td></tr><tr><td>Mass Matrix</td><td><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/496e4b64dd9f889fd213e81d04665886.png" alt="image-20250111185559312" style="zoom:50%"></td><td><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/2d4dfa80211279e783f9f58274e4a761.png" alt="image-20250111185507153" style="zoom:50%"></td></tr></tbody></table><p>在CRB的计算中，<code>genesis</code>和<code>mujoco</code>使用了一样的策略。从末端开始遍历，自下而上地累计惯性。</p><p>有这个惯性矩阵之后，再计算每个自由度的惯性贡献，更新自由度状态 <code>f_ang</code>（角力矩）和 <code>f_vel</code>（线力矩）。然后填充这个质量矩阵。</p><p>实现细节上，<code>genesis</code>会有一个<code>休眠</code>的判断，避免了不必要的计算。此外，<code>genesis</code>如下定义力矩计算的函数：</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/1094c49295aa3558a27ca732bc4a8c6a.png" alt="image-20250111175057211" style="zoom:50%"></p><p>使用<code>@ti.func</code>修饰，将运算从Python虚拟机移到Taichi进行加速。而mujoco中此函数的处理是按照单个元素进行处理的：</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/4b9ce53dc5fd8a976427ce19cd613924.png" alt="image-20250111184015895" style="zoom:50%"></p><p>这种非连续的取值以及单元素的运算可能也是导致效率降低的原因。</p><h3 id="inversed-mass-matrix">2. Inversed Mass Matrix</h3><p>为解释矩阵逆的计算，先简要引入两个矩阵分解方式的介绍：</p><table><colgroup><col style="width:50%"><col style="width:50%"></colgroup><thead><tr><th><span class="math inline">\(LU\)</span>分解</th><th><span class="math inline">\(LDL^T\)</span>分解</th></tr></thead><tbody><tr><td><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/1f04703dc79c1e2e0c2a0dd74523bade.png" alt="image-20250109231735947" style="zoom:50%"></td><td><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/2ce532293557987b31a3c19b5971144c.png" alt="image-20250109231845312" style="zoom:50%"></td></tr></tbody></table><p>genesis:</p><ul><li>对质量矩阵 <code>mass_mat</code> 进行 LU 分解。</li><li>使用前向和后向替代，逐列计算逆矩阵 <code>mass_mat_inv</code>。</li></ul><p>在genesis中，为了简化质量矩阵的逆矩阵的计算，使用了<span class="math inline">\(LU\)</span>分解。而在mujoco中，使用的是 <span class="math inline">\(LDL^T\)</span>​分解。这两者我感觉本身计算量的差别不会太大。然而在genesis的计算中，对于自由度的遍历依然可以实现并行化：</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/20f0446ae58908165b94d8d76ddf0b68.png" alt="image-20250111192621125" style="zoom:50%"></p><p>此外，在分解的过程中。mujoco中自己定义了函数，是通过简单的遍历实现的。</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/e8cb0fb290e09d5e7f1c50e69a176fd9.png" alt="image-20250111192953817" style="zoom:50%"></p><p>在genesis中，虽然也是遍历，但是它的参数都是通过taichi重构的，可能相较于原生的C语言会有一定的加速。</p><h3 id="force-calculation">3. Force Calculation</h3><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/cdf3e2f00f8bb7eb34a5ebbb0e3b2c0d.png" alt="image-20250112192834024" style="zoom:50%"></p><p>该函数的目的是计算每个自由度上的总力，包括控制力、阻尼力和弹性力。</p><p>在力的计算中，genesis中有三种控制模式，根据代码，分别是<code>FORCE</code>、<code>VELOCITY</code>、<code>POSITION</code>。</p><p><strong>控制模式</strong>：</p><ol type="1"><li><p><code>FORCE</code> 模式：</p><ul><li>直接将控制力 <code>ctrl_force</code> 应用于自由度。</li></ul></li><li><p><code>VELOCITY</code> 模式：</p><ul><li><p>根据当前速度 <code>vel</code> 和目标速度 <code>ctrl_vel</code> 计算阻尼力：</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">force = kv * (ctrl_vel - vel)</span><br></pre></td></tr></table></figure></div></li><li><p><code>kv</code> 是速度控制的增益系数。</p></li></ul></li><li><p><code>POSITION</code> 模式：</p><ul><li><p>根据当前位置 <code>pos</code> 和目标位置 <code>ctrl_pos</code> 计算弹性力和阻尼力：</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">force = kp * (ctrl_pos - pos) - kv * vel</span><br></pre></td></tr></table></figure></div></li><li><p><code>kp</code> 是位置控制的增益系数。</p></li></ul></li></ol><p>如果计算出的力大于阈值<code>EPS</code>，则唤醒实体。</p><p>此外，<code>force</code>还需要根据如下方式减去弹性力和阻尼力：</p><div class="code-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">force -= qpos * stiffness</span><br><span class="line">force -= damping * vel</span><br></pre></td></tr></table></figure></div><p>mujoco中也是三种控制，<code>position</code>、<code>velocity</code>和<code>acceleration</code>，大体上是一致的：</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/79d627cbede478874c5e38237abaeb25.png" alt="image-20250112195343709" style="zoom:50%"></p><h3 id="update-acceleration-and-force">4. Update Acceleration and Force</h3><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/f5803e19f0ff8e524328fb47a5fcbf1c.png" alt="image-20250112201317574" style="zoom:50%"></p><p>遍历每个<code>Entity</code>的每个<code>Link</code>，是根节点的话，设置线加速度为重力加速度，角加速度为0。不是根节点则继承父节点的加速度。</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/1d2aad53d6d09d872211974a1b2f2a78.png" alt="image-20250112201530219" style="zoom:50%"></p><p><strong>流程</strong>：</p><ul><li>遍历链接的所有自由度（从 <code>dof_start</code> 到 <code>dof_end</code>）。</li><li>对每个自由度：<ul><li>根据自由度的速度 <code>vel</code>，计算其对线加速度的贡献 <code>cdofd_vel * vel</code>。</li><li>计算其对角加速度的贡献 <code>cdofd_ang * vel</code>。</li></ul></li></ul><p>力和力矩的计算与加速度计算类似。且其中调用的都是<code>@ti.func</code>修饰的矩阵运算函数。</p><h3 id="inverse-link-force">5. Inverse Link Force</h3><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/fd8b099b6a637dd05e4f23af80006c17.png" alt="image-20250112214627762" style="zoom:50%"></p><p>从每个实体的末端链接开始，向父链接累积力。</p><h3 id="bias-force">6. Bias Force</h3><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/78f312339039b1b06fd607b03d7dedb2.png" alt="image-20250112214627762" style="zoom:50%"></p><p>基于链接的累积力和每个自由度的运动相关量，计算偏置力。</p><p><strong>分量解释</strong>：</p><ul><li><code>cdof_ang</code> 和 <code>cdof_vel</code> 是每个自由度的运动分量（角速度分量和线速度分量）。</li><li><code>cfrc_flat_ang</code> 和 <code>cfrc_flat_vel</code> 是链接的累积角力和线力。</li><li><strong>偏置力的计算</strong>：通过上述点积操作，将累积的力和自由度的运动相关联，得出自由度上的偏置力。</li></ul><h3 id="compute-dof-acceleration">7. Compute DOF Acceleration</h3><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/64e951eee65415b04beb10a07c3e3e11.png" alt="image-20250112230444496" style="zoom:50%"></p><p>对每个DOF，他要遍历添加所有其他DOF给它施加的约束力。</p><ul><li>将约束力 <code>qf_constraint</code> 添加到当前自由度的总力上。</li><li>再使用质量矩阵的逆<span class="math inline">\(M^{-1}\)</span>和总力<code>force</code>计算加速度<code>acc</code>。</li></ul><h3 id="integrate">8. Integrate</h3><p>基于当前自由度的加速度和速度，计算并更新自由度的状态（包括位置和速度）。</p><p>基于加速度更新速度<span class="math inline">\(v\leftarrow v+a\cdot\Delta t\)</span>：</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/2d6f7202f4ff67623b46694830ac17af.png" alt="image-20250112234806714" style="zoom:50%"></p><p>更新位置：</p><ol type="1"><li><p>旋转状态和旋转增量：</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/d06241284fd7085371fba0452a44f680.png" alt="image-20250113010301128" style="zoom:50%"></p><p><code>rot</code> 代表刚体在全局坐标系中的当前旋转状态。</p><p><code>ang</code> 则是时间步内的旋转变化，由角速度直接导出。</p></li><li><p>旋转合并：</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/65db9c9ae80ae40f5c6902151c642847.png" alt="image-20250113011440843" style="zoom:50%"></p><p>将旋转向量<span class="math inline">\(\mathbf{ang}\)</span>转换为四元数。</p><p>再通过四元数乘法更新当前的旋转状态<code>rot</code>。</p></li><li><p>以上是FREE JOINT的更新方式，非FREE的直接根据<code>vel</code>更新即可：</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/b66c6d877a27982065be083dbdc8ba65.png" alt="image-20250113013114786" style="zoom:50%"></p></li></ol><h3 id="contraint-force">9. Contraint Force</h3><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/67563b73010d6175be9d09779402580a.png" alt="image-20250113014423944" style="zoom:50%"></p><p>以下详细对比下genesis和mujoco在碰撞检测中的实现：</p><ol type="1"><li><p>Broad Phase:</p><p>在genesis和mujoco中，都使用了AABB对碰撞检测对进行一个快速的排除。但是它的具体的实现细节又有所不同。</p><p>在genesis中，使用的是<code>Sweep and Prune (SAP)</code>方式，它将所有物体AABB盒的Min点与Max点分别在XYZ轴上投影，如果在某一轴上不满足<code>Max1 &gt; Min2 &amp;&amp; Max2 &gt; Min1</code>则不会发生碰撞。</p><p>在mujoco中，使用的是<code>Bounding Volume Hierarchical Tree(BVH)</code>算法。它是通过二叉树来管理所有的AABB盒。在计算碰撞时，遍历二叉树以获取所有可能的碰撞对。</p></li><li><p>Narrow Phase:</p><p>窄相检测的目的是根据宽相检测检测出的碰撞对再进行细致的计算，获取碰撞接触点、法向量、穿透深度等信息。</p><p>窄相检测中，genesis使用的是<code>SDF</code>方法。根据物体的类别，<code>SPHERE</code>、<code>TERRAIN</code>、<code>CONVEX</code>或者其他，调用不同的函数。在<code>SDF</code>底层实现中，genesis使用的依然是遍历查询每个顶点，判断是否侵入另一个物体。</p><p>在mujoco中，定义了一个碰撞函数检测表： <img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/20953839038b4920d64eae8984dc820a.png" alt="image-20250113191309572" style="zoom:50%"></p><p>不同于genesis全部计算<code>SDF</code>，mujoco中对于凸包与凸包间的碰撞，使用了<code>GJK</code>算法来判断凸包是否相交，如果检测到相交，再用<code>EPA</code>算法计算穿透深度和接触点。</p></li><li><p>Add Constraint:</p><p>在获取到碰撞信息后，genesis会通过<code>add_collision_constraints</code>函数将约束施加回去。mujoco中通过函数<code>mj_makeConstraint</code>添加约束。</p></li></ol><h2 id="performance-analysis">Performance Analysis</h2><h3 id="taichi-1">1. Taichi</h3><h4 id="data-structure">(1). data structure</h4><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/b560abfddc5ca20fc153337ab486947d.png" alt="image-20250111171708819" style="zoom:50%"></p><p>在genesis的初始化中，很多变量就以taichi的数据格式进行初始化了，便于后续高效处理。</p><h4 id="parallelize">(2). Parallelize</h4><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/6155ed5f4f4fa995ec096701602416a2.png" alt="image-20250111171929017" style="zoom:50%"></p><p>genesis使用了taichi的<code>loop_config</code>函数进行并行化的控制。其中<code>serialize</code>控制是否并行，如果将<code>serialize</code>设置为 <code>True</code> ，则for循环将串行运行。关于<code>_para_level</code>的定义在此：</p><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/974d855b240efade15a0e0e9b4bdc38f.png" alt="image-20250111172228892" style="zoom:50%"></p><p>在使用CPU时不进行并行。GPU时根据场景是否分批次进行部分或全部的并行。</p><h3 id="hibernation">2. hibernation</h3><p><img lazyload src="/images/loading.svg" data-src="https://pub-70fb49a5419e4021a1be66effc7bcf9e.r2.dev/2025/01/fb7c678e52495e3dccd93adad607920b.png" alt="image-20250110215135068" style="zoom:50%"></p><p><strong>功能启用</strong>:</p><ul><li><code>hibernation</code> 的启用由 <code>self._use_hibernation</code> 参数控制。</li><li>当启用时，程序会在初始化中设定相关状态变量，例如 <code>self.dofs_state.hibernated</code> 和 <code>self.links_state.hibernated</code> 标记rigid_solverrigid_solver。</li></ul><p><strong>状态检测</strong>:</p><ul><li>判断刚体是否进入 hibernation 的依据是速度和加速度的阈值（<code>self._hibernation_thresh_vel</code> 和 <code>self._hibernation_thresh_acc</code>）。如果某个刚体的运动状态低于这些阈值，则会被标记为“休眠”状态rigid_solverrigid_solver。</li></ul><p><strong>休眠机制的作用</strong>:</p><ul><li>对于被标记为 hibernated 的刚体，程序会从后续的物理计算中剔除它们。这包括质量矩阵计算、动态求解以及碰撞检测等部分rigid_solver。</li><li>只有当这些刚体再次被外力或约束影响而超出阈值时，它们才会被重新唤醒并重新加入计算rigid_solver。</li></ul><p><strong>核心实现</strong>:</p><ul><li><code>self._func_hibernate()</code> 函数处理刚体是否应该进入 hibernation 的逻辑rigid_solver。</li><li><code>self._func_aggregate_awake_entities()</code> 则用于更新非休眠状态的实体列表，以确保只对活跃的刚体执行仿真rigid_solver。</li></ul><p><strong>性能优化</strong>:</p><ul><li>通过减少对静态或低动态实体的重复计算，hibernation 可以显著降低复杂场景中的计算开销。</li><li>适用于场景中存在大量静止或近似静止的物体的情况。</li></ul></div><div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8"><div class="article-copyright-info-container"><ul><li><strong>标题:</strong> Genesis分析</li><li><strong>作者:</strong> Felix Christian</li><li><strong>创建于 :</strong> 2025-01-11 18:57:05</li><li><strong>更新于 :</strong> 2025-02-06 20:13:37</li><li><strong>链接:</strong> https://felixchristian.top/2025/01/11/15-GenesisAnalysis/</li><li><strong>版权声明: </strong>本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。</li></ul></div></div><ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden"><li class="tag-item mx-0.5"><a href="/tags/mujoco/">#mujoco</a>&nbsp;</li><li class="tag-item mx-0.5"><a href="/tags/genesis/">#genesis</a>&nbsp;</li></ul><div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8"><div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="prev" rel="prev" href="/2025/06/16/16-DeepRL_lecture1/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item truncate max-w-48">MDPs and Exact Solution Methods</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2"><a class="next" rel="next" href="/2025/01/09/14-SceneRecognition/"><span class="title flex justify-center items-center"><span class="post-nav-title-item truncate max-w-48">Scene Recognition with Bag of Words</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div><div class="comment-container px-2 sm:px-6 md:px-8 pb-8"><div class="comments-container mt-10 w-full"><div id="comment-anchor" class="w-full h-2.5"></div><div class="comment-area-title w-full my-1.5 md:my-2.5 text-xl md:text-3xl font-bold">评论</div><div id="giscus-container"></div><script data-swup-reload-script defer>async function loadGiscus(){const t={src:"https://giscus.app/client.js","data-repo":"FelixChristian011226/giscus","data-repo-id":"R_kgDONKpzVw","data-category":"Announcements","data-category-id":"DIC_kwDONKpzV84Cj_Tj","data-mapping":"title","data-strict":"0","data-reactions-enabled":"1","data-emit-metadata":"1","data-theme":"preferred_color_scheme","data-lang":"en","data-input-position":"top","data-loading":"lazy",crossorigin:"anonymous",async:!0},a=document.createElement("script");for(const e in t)a.setAttribute(e,t[e]);document.getElementById("giscus-container").appendChild(a)}{let t=setTimeout(()=>{loadGiscus(),clearTimeout(t)},1e3)}</script></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">目录</div><div class="page-title">Genesis分析</div><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#taichi"><span class="nav-text">Taichi</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#ti.func-ti.kernel"><span class="nav-text">@ti.func &amp; @ti.kernel</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ti.dataclass"><span class="nav-text">@ti.dataclass</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#field"><span class="nav-text">Field</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ndarray"><span class="nav-text">Ndarray</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#genesis"><span class="nav-text">Genesis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#rigid-solver"><span class="nav-text">Rigid Solver</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#comparison-with-genesis-and-mujoco"><span class="nav-text">Comparison with Genesis and Mujoco</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#pipeline"><span class="nav-text">0. Pipeline</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mass-matrix"><span class="nav-text">1. Mass Matrix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inversed-mass-matrix"><span class="nav-text">2. Inversed Mass Matrix</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#force-calculation"><span class="nav-text">3. Force Calculation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#update-acceleration-and-force"><span class="nav-text">4. Update Acceleration and Force</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#inverse-link-force"><span class="nav-text">5. Inverse Link Force</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#bias-force"><span class="nav-text">6. Bias Force</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#compute-dof-acceleration"><span class="nav-text">7. Compute DOF Acceleration</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#integrate"><span class="nav-text">8. Integrate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#contraint-force"><span class="nav-text">9. Contraint Force</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#performance-analysis"><span class="nav-text">Performance Analysis</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#taichi-1"><span class="nav-text">1. Taichi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hibernation"><span class="nav-text">2. hibernation</span></a></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2024</span> - 2026&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Felix Christian</a><p class="post-count space-x-0.5"><span>共撰写了 26 篇文章 </span><span>共 48.2k 字</span></p></div><script data-swup-reload-script src="https://cn.vercount.one/js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">访问人数</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">总访问量</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span> <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.8.5</a></span></div><div>博客已运行 <span class="odometer" id="runtime_days"></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li><li class="go-comment"><i class="fa-regular fa-comments"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="站内搜索您需要的内容..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/Swup.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupSlideTheme.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupScriptsPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupProgressPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupScrollPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/imageViewer.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/utils.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/main.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/navbarShrink.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/scrollTopBottom.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/lightDarkSwitch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/categoryList.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/localSearch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/codeBlock.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/lazyload.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/runtime.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/odometer.min.js"></script><link rel="stylesheet" href="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/assets/odometer-theme-minimal.css"><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/Typed.min.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/plugins/typed.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/mermaid.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/plugins/mermaid.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/anime.min.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/tools/tocToggle.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/toc.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/plugins/tabs.js" data-swup-reload-script></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/libs/moment-with-locales.min.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/essays.js" data-swup-reload-script></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.8.5/source/js/build/layouts/bookmarkNav.js"></script></body></html>